<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CLAS Korean FlashCards</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        /* Intro Overlay Animation */
        .intro-overlay {
            position: fixed;
            inset: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            opacity: 1;
            transition: opacity 1s ease-out;
        }

        .intro-overlay.fade-out {
            opacity: 0;
            pointer-events: none;
        }

        .intro-content {
            position: absolute;
            text-align: center;
            color: white;
            animation: pulse 2s ease-in-out infinite;
            opacity: 0;
            transition: opacity 0.8s ease-in;
        }

        .intro-content.show {
            opacity: 1;
        }

        .intro-content h2 {
            font-size: 48px;
            font-weight: 800;
            text-shadow: 0 4px 12px rgba(0,0,0,0.3);
            letter-spacing: 2px;
            margin-bottom: 10px;
        }

        .intro-content p {
            font-size: 20px;
            opacity: 0.9;
            font-style: italic;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 600px;
            width: 100%;
            padding: 30px;
            position: relative;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
            font-size: 32px;
        }

        .topic-selector {
            width: 100%;
            padding: 12px;
            font-size: 18px;
            border: 2px solid #667eea;
            border-radius: 10px;
            margin-bottom: 20px;
            background: white;
            cursor: pointer;
        }

        .mode-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .mode-btn {
            background: #e0e0e0;
            color: #333;
            padding: 8px 16px;
            font-size: 14px;
            border-radius: 20px;
            border: 2px solid transparent;
        }

        .mode-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .mode-btn:hover:not(.active) {
            background: #bdbdbd;
        }

        .card-container {
            perspective: 1000px;
            height: 300px;
            margin-bottom: 25px;
            position: relative;
            touch-action: none;
        }

        .card {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s;
            cursor: pointer;
            user-select: none;
        }

        .card.flipped {
            transform: rotateY(180deg);
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 30px;
            text-align: center;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            overflow-wrap: break-word;
            word-wrap: break-word;
        }

        .card-front {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-size: 26px;
        }

        .card-back {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            transform: rotateY(180deg);
            font-size: 36px;
            line-height: 1.5;
            letter-spacing: 1px;
        }

        .skip-btn {
            background: #FF9800;
        }

        .skip-btn:hover {
            background: #F57C00;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 10px;
            font-size: 18px;
            cursor: pointer;
            transition: background 0.3s;
            flex: 1;
        }

        button:hover {
            background: #764ba2;
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .correct-btn {
            background: #4CAF50;
            display: none;
            margin-bottom: 15px;
        }

        .correct-btn:hover {
            background: #45a049;
        }

        .correct-btn.show {
            display: block;
        }

        .correct-btn:disabled {
            background: #81C784;
        }

        .progress-bar-container {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            margin: 15px 0;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s ease;
        }

        .shortcuts-legend {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 12px;
            color: #666;
            text-align: center;
        }

        .shortcuts-legend kbd {
            background: #333;
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
        }

        .progress {
            text-align: center;
            color: #666;
            font-size: 16px;
            margin-top: 10px;
            font-weight: bold;
        }

        .flip-hint {
            text-align: center;
            color: #999;
            font-size: 14px;
            margin-top: 10px;
            font-style: italic;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        .stat {
            text-align: center;
        }

        .stat-number {
            font-size: 28px;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }

        .reset-btn {
            background: #f44336;
            margin: 25px auto 0;
            display: block;
            max-width: 200px;
        }

        .reset-btn:hover {
            background: #da190b;
        }

        @media (max-width: 600px) {
            .intro-content h2 {
                font-size: 32px;
            }
            .intro-content p {
                font-size: 16px;
            }
            .card-back {
                font-size: 30px;
            }
            .container {
                max-width: 95%;
                padding: 20px;
            }
            .button-group {
                flex-direction: column;
            }
            .mode-buttons {
                flex-direction: column;
            }
            h1 {
                font-size: 24px;
            }
            .skip-btn {
                margin-left: 0;
                margin-top: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- Intro Animation with Text Only -->
    <div class="intro-overlay" id="introOverlay">
        <div class="intro-content" id="introContent">
            <h2>CLAS</h2>
            <h2>..::: PRESENTs :::..</h2>
            <h2>Batch 27B</h2>
            <p>Better Learning, Better Future</p>
        </div>
    </div>

    <div class="container">
        <h1>CLAS Korean FlashCards</h1>
        
        <select class="topic-selector" id="topicSelector">
            <option value="">Select a Topic</option>
        </select>

        <div class="mode-buttons" id="modeButtons" style="display: none;">
            <button class="mode-btn active" id="sequentialBtn" onclick="setStudyMode('sequential')">Sequential</button>
            <button class="mode-btn" id="shuffleBtn" onclick="setStudyMode('shuffle')">Shuffle</button>
            <button class="mode-btn" id="incorrectBtn" onclick="setStudyMode('incorrect')">Study Incorrect</button>
        </div>

        <div class="card-container" id="cardContainer">
            <div class="card" id="flashcard">
                <div class="card-face card-front" id="cardFront">
                    Select a topic to begin
                </div>
                <div class="card-face card-back" id="cardBack">
                    Flip to see answer
                </div>
            </div>
        </div>

        <div class="flip-hint">Click card to flip ‚Ä¢ Keyboard: Space/Enter to flip, ‚Üê ‚Üí arrows to navigate, C to mark correct, S to skip</div>

        <div class="button-group">
            <button id="prevBtn" onclick="previousCard()">Previous</button>
            <button id="nextBtn" onclick="nextCard()">Next</button>
            <button class="skip-btn" id="skipBtn" onclick="skipCard()">Skip ‚è≠Ô∏è</button>
        </div>

        <button class="correct-btn" id="correctBtn" onclick="markCorrect()">Mark Correct ‚úÖ</button>

        <div class="progress-bar-container">
            <div class="progress-bar" id="progressBar"></div>
        </div>

        <div class="progress" id="progress">0 / 0 cards</div>

        <div class="stats">
            <div class="stat">
                <div class="stat-number" id="totalCards">0</div>
                <div class="stat-label">Total Cards</div>
            </div>
            <div class="stat">
                <div class="stat-number" id="scoreCards">0</div>
                <div class="stat-label">Correct</div>
            </div>
            <div class="stat">
                <div class="stat-number" id="incorrectCards">0</div>
                <div class="stat-label">Need Work</div>
            </div>
        </div>

        <div class="shortcuts-legend" id="shortcutsLegend" style="display: none;">
            <strong>Keyboard:</strong> 
            <kbd>Space</kbd> Flip | <kbd>‚Üê‚Üí</kbd> Navigate | <kbd>C</kbd> Correct | <kbd>S</kbd> Skip | <kbd>R</kbd> Reset
        </div>

        <button class="reset-btn" id="resetBtn" onclick="resetSession()">Reset Session üîÑ</button>
    </div>

    <script>
        // Handle intro animation sequence
        (function() {
            const introOverlay = document.getElementById('introOverlay');
            const introContent = document.getElementById('introContent');
            
            // Check if this is a new session (not a refresh)
            if (!sessionStorage.getItem('clasIntroShown')) {
                // Show animation sequence
                setTimeout(() => {
                    // Show legacy content immediately
                    introContent.classList.add('show');
                    
                    // Fade out entire overlay after 3 seconds total
                    setTimeout(() => {
                        introOverlay.classList.add('fade-out');
                        setTimeout(() => {
                            introOverlay.remove();
                        }, 1000);
                    }, 3000);
                }, 2000); // Show for 2 seconds before fading
                
                // Mark as shown for this session
                sessionStorage.setItem('clasIntroShown', 'true');
            } else {
                // Remove immediately if already shown
                introOverlay.remove();
            }
        })();

        // Flashcard Data starts here.
        const flashcards = [
            // Day 1: Hangul Alphabet (20 cards)
            {front: "„Öè", back: '"a" as in for "Papa"', topic: "Day 1: Hangul Alphabet"},
            {front: "„Öë", back: '"ya" as in "yacht"', topic: "Day 1: Hangul Alphabet"},
            {front: "„Öì", back: '"eo" as in "Pho" (a vietnames dish/soup)', topic: "Day 1: Hangul Alphabet"},
            {front: "„Öï", back: '"yeo"', topic: "Day 1: Hangul Alphabet"},
            {front: "„Öó", back: '"o" as in "go"', topic: "Day 1: Hangul Alphabet"},
            {front: "„Öõ", back: '"yo" as in "yoga"', topic: "Day 1: Hangul Alphabet"},
            {front: "„Öú", back: '"u" as in "boot"', topic: "Day 1: Hangul Alphabet"},
            {front: "„Ö†", back: '"yu" as in "youth"', topic: "Day 1: Hangul Alphabet"},
            {front: "„Ö°", back: '"eu" (no English equivalent)', topic: "Day 1: Hangul Alphabet"},
            {front: "„Ö£", back: '"ee" as in "see"', topic: "Day 1: Hangul Alphabet"},
            {front: "„Ñ±", back: "g/k sound", topic: "Day 1: Hangul Alphabet"},
            {front: "„Ñ¥", back: "n sound", topic: "Day 1: Hangul Alphabet"},
            {front: "„Ñ∑", back: "d/t sound", topic: "Day 1: Hangul Alphabet"},
            {front: "„Ñπ", back: "r/l sound", topic: "Day 1: Hangul Alphabet"},
            {front: "„ÖÅ", back: "m sound", topic: "Day 1: Hangul Alphabet"},
            {front: "„ÖÇ", back: "b/p sound", topic: "Day 1: Hangul Alphabet"},
            {front: "„ÖÖ", back: "s sound", topic: "Day 1: Hangul Alphabet"},
            {front: "„Öá", back: "Silent (initial) / ng (final)", topic: "Day 1: Hangul Alphabet"},
            {front: "„Öà", back: "j sound", topic: "Day 1: Hangul Alphabet"},
            {front: "Double Consonants: „Ñ≤, „Ñ∏, „ÖÉ, „ÖÜ, „Öâ", back: "Tense sounds", topic: "Day 1: Hangul Alphabet"},

            // Day 2: Final Consonants (4 cards)
            {front: "What happens to „Öã, „Öå, „Öä, „Öç in final position?", back: "They sound like „Öã[k], „Öå[t], „Öä[ch], „Öç[p]", topic: "Day 2: Final Consonants"},
            {front: "What happens to „Ñ¥, „Ñπ, „ÖÅ, „Öá in final position?", back: "They keep their sound „Ñ¥, „Ñπ, „ÖÅ, „Öá [n, l, m, ng]", topic: "Day 2: Final Consonants"},
            {front: "What happens to „ÖÇ in final position?", back: "Sounds like „ÖÇ [p]", topic: "Day 2: Final Consonants"},
            {front: "When is „Öá silent vs. pronounced?", back: "Silent when initial (ÏïÑÎ≤ÑÏßÄ), pronounced 'ng' when final (Í∞ï)", topic: "Day 2: Final Consonants"},

            // Day 3: Numbers (6 cards)
            {front: "Sino-Korean: 1, 2, 3, 4, 5", back: "Ïùº, Ïù¥, ÏÇº, ÏÇ¨, Ïò§", topic: "Day 3: Numbers"},
            {front: "Native Korean: 1, 2, 3, 4, 5", back: "ÌïòÎÇò, Îëò, ÏÖã, ÎÑ∑, Îã§ÏÑØ", topic: "Day 3: Numbers"},
            {front: "When to use Sino-Korean numbers?", back: "Dates, money, addresses, phone numbers, math, counting over 100", topic: "Day 3: Numbers"},
            {front: "When to use Native Korean numbers?", back: "Counting objects, hours, age, months, points in games", topic: "Day 3: Numbers"},
            {front: "Sino-Korean: 20, 30, 40, 50, 60,  70, 80, 90", back: "Ïù¥Ïã≠, ÏÇºÏã≠, ÏÇ¨Ïã≠, Ïò§Ïã≠, Ïú°Ïã≠, Ïπ†Ïã≠, ÌåîÏã≠, Íµ¨Ïã≠", topic: "Day 3: Numbers"},
            {front: "Native Korean: 20, 30, 40, 50, 60, 70, 80, 90", back: "Ïä§Î¨º, ÏÑúÎ•∏, ÎßàÌùî, Ïâ∞, ÏòàÏàú, ÏùºÌùî, Ïó¨Îì†, ÏïÑÌùî", topic: "Day 3: Numbers"},

            // Day 4: Counting Units (10 cards)
            {front: "Counter for general things", back: "Í∞ú", topic: "Day 4: Counting Units"},
            {front: "Counter for people (honorific)", back: "Î∂Ñ", topic: "Day 4: Counting Units"},
            {front: "Counter for people (casual)", back: "Î™Ö", topic: "Day 4: Counting Units"},
            {front: "Counter for animals", back: "ÎßàÎ¶¨", topic: "Day 4: Counting Units"},
            {front: "Counter for bottles", back: "Î≥ë", topic: "Day 4: Counting Units"},
            {front: "Counter for cups/glasses", back: "Ïûî", topic: "Day 4: Counting Units"},
            {front: "Counter for flat things (paper)", back: "Ïû•", topic: "Day 4: Counting Units"},
            {front: "Counter for books", back: "Í∂å", topic: "Day 4: Counting Units"},
            {front: "Counter for shoes/socks", back: "Ïº§Î†à", topic: "Day 4: Counting Units"},
            {front: "Counter for vehicles/machines", back: "ÎåÄ", topic: "Day 4: Counting Units"},

            // Day 5: Time & Days (15 cards)
            {front: "Monday", back: "ÏõîÏöîÏùº", topic: "Day 5: Time & Days"},
            {front: "Tuesday", back: "ÌôîÏöîÏùº", topic: "Day 5: Time & Days"},
            {front: "Wednesday", back: "ÏàòÏöîÏùº", topic: "Day 5: Time & Days"},
            {front: "Thursday", back: "Î™©ÏöîÏùº", topic: "Day 5: Time & Days"},
            {front: "Friday", back: "Í∏àÏöîÏùº", topic: "Day 5: Time & Days"},
            {front: "Saturday", back: "ÌÜ†ÏöîÏùº", topic: "Day 5: Time & Days"},
            {front: "Sunday", back: "ÏùºÏöîÏùº", topic: "Day 5: Time & Days"},
            {front: "What time is it? (formal)", back: "ÏßÄÍ∏à Î™á ÏãúÏòàÏöî?", topic: "Day 5: Time & Days"},
            {front: "1 o'clock", back: "Ìïú Ïãú", topic: "Day 5: Time & Days"},
            {front: "Half past", back: "Î∞ò", topic: "Day 5: Time & Days"},
            {front: "Morning", back: "ÏïÑÏπ®", topic: "Day 5: Time & Days"},
            {front: "Lunch", back: "Ï†êÏã¨", topic: "Day 5: Time & Days"},
            {front: "Evening", back: "Ï†ÄÎÖÅ", topic: "Day 5: Time & Days"},
            {front: "Midnight", back: "ÏûêÏ†ï", topic: "Day 5: Time & Days"},
            {front: "Dawn", back: "ÏÉàÎ≤Ω", topic: "Day 5: Time & Days"},

            // Day 6: Dates (15 cards)
            {front: "January", back: "ÏùºÏõî", topic: "Day 6: Dates"},
            {front: "February", back: "Ïù¥Ïõî", topic: "Day 6: Dates"},
            {front: "March", back: "ÏÇºÏõî", topic: "Day 6: Dates"},
            {front: "April", back: "ÏÇ¨Ïõî", topic: "Day 6: Dates"},
            {front: "May", back: "Ïò§Ïõî", topic: "Day 6: Dates"},
            {front: "June", back: "Ïú†Ïõî (NOT Ïú°Ïõî)", topic: "Day 6: Dates"},
            {front: "July", back: "Ïπ†Ïõî", topic: "Day 6: Dates"},
            {front: "August", back: "ÌåîÏõî", topic: "Day 6: Dates"},
            {front: "September", back: "Íµ¨Ïõî", topic: "Day 6: Dates"},
            {front: "October", back: "ÏãúÏõî (NOT Ïã≠Ïõî)", topic: "Day 6: Dates"},
            {front: "November", back: "Ïã≠ÏùºÏõî", topic: "Day 6: Dates"},
            {front: "December", back: "Ïã≠Ïù¥Ïõî", topic: "Day 6: Dates"},
            {front: "What date is today?", back: "Ïò§Îäò Î©∞Ïπ†Ïù¥ÏóêÏöî?", topic: "Day 6: Dates"},
            {front: "Birthday", back: "ÏÉùÏùº", topic: "Day 6: Dates"},
            {front: "When is your birthday?", back: "ÏÉùÏùºÏù¥ Ïñ∏Ï†úÏòàÏöî?", topic: "Day 6: Dates"},

            // Day 7: Grammar (14 cards)
            {front: "Topic marker (after vowel)", back: "Îäî", topic: "Day 7: Grammar"},
            {front: "Topic marker (after consonant)", back: "ÏùÄ", topic: "Day 7: Grammar"},
            {front: "Subject marker (after vowel)", back: "Í∞Ä", topic: "Day 7: Grammar"},
            {front: "Subject marker (after consonant)", back: "Ïù¥", topic: "Day 7: Grammar"},
            {front: "Use Îäî/ÏùÄ when...", back: "Making general statements or identifying a topic", topic: "Day 7: Grammar"},
            {front: "Use Ïù¥/Í∞Ä when...", back: "Emphasizing a specific subject known to both speaker and listener", topic: "Day 7: Grammar"},
            {front: "Present tense: Í∞ÄÎã§ (to go)", back: "Í∞ÄÏöî", topic: "Day 7: Grammar"},
            {front: "Present tense: Î®πÎã§ (to eat)", back: "Î®πÏñ¥Ïöî", topic: "Day 7: Grammar"},
            {front: "Present tense: Ïù¥Îã§ (to be)", back: "ÏòàÏöî/Ïù¥ÏóêÏöî", topic: "Day 7: Grammar"},
            {front: "Past tense: Í∞ÄÎã§", back: "Í∞îÏñ¥Ïöî", topic: "Day 7: Grammar"},
            {front: "Past tense: Î®πÎã§", back: "Î®πÏóàÏñ¥Ïöî", topic: "Day 7: Grammar"},
            {front: "Past tense rule for vowel „Öè/„Öó", back: "+ ÏïòÏñ¥Ïöî (e.g., Í∞ÄÎã§ ‚Üí Í∞îÏñ¥Ïöî)", topic: "Day 7: Grammar"},
            {front: "Past tense rule for other vowels", back: "+ ÏóàÏñ¥Ïöî (e.g., Î®πÎã§ ‚Üí Î®πÏóàÏñ¥Ïöî)", topic: "Day 7: Grammar"},
            {front: "Past tense rule for ÌïòÎã§ verbs", back: "+ ÏòÄÏñ¥Ïöî (e.g., Í≥µÎ∂ÄÌïòÎã§ ‚Üí Í≥µÎ∂ÄÌñàÏñ¥Ïöî)", topic: "Day 7: Grammar"},

            // Bonus: General Vocabulary (16 cards)
            {front: "Yes", back: "ÎÑ§", topic: "Bonus: Essential Vocabulary"},
            {front: "No", back: "ÏïÑÎãàÏöî", topic: "Bonus: Essential Vocabulary"},
            {front: "Thank you", back: "Í∞êÏÇ¨Ìï©ÎãàÎã§", topic: "Bonus: Essential Vocabulary"},
            {front: "Hello (formal)", back: "ÏïàÎÖïÌïòÏÑ∏Ïöî", topic: "Bonus: Essential Vocabulary"},
            {front: "Goodbye (to person leaving)", back: "ÏïàÎÖïÌûà Í∞ÄÏÑ∏Ïöî", topic: "Bonus: Essential Vocabulary"},
            {front: "Goodbye (to person staying)", back: "ÏïàÎÖïÌûà Í≥ÑÏÑ∏Ïöî", topic: "Bonus: Essential Vocabulary"},
            {front: "I'm sorry", back: "Ï£ÑÏÜ°Ìï©ÎãàÎã§", topic: "Bonus: Essential Vocabulary"},
            {front: "Excuse me", back: "Ï†ÄÍ∏∞Ïöî", topic: "Bonus: Essential Vocabulary"},
            {front: "How much is it?", back: "ÏñºÎßàÏòàÏöî?", topic: "Bonus: Essential Vocabulary"},
            {front: "Where is...?", back: "...Ïñ¥ÎîîÏòàÏöî?", topic: "Bonus: Essential Vocabulary"},
            {front: "Restroom", back: "ÌôîÏû•Ïã§", topic: "Bonus: Essential Vocabulary"},
            {front: "Restaurant", back: "ÏãùÎãπ", topic: "Bonus: Essential Vocabulary"},
            {front: "Coffee shop", back: "Ïπ¥Ìéò", topic: "Bonus: Essential Vocabulary"},
            {front: "Library", back: "ÎèÑÏÑúÍ¥Ä", topic: "Bonus: Essential Vocabulary"},
            {front: "School", back: "ÌïôÍµê", topic: "Bonus: Essential Vocabulary"},
            {front: "Hospital", back: "Î≥ëÏõê", topic: "Bonus: Essential Vocabulary"}
        ];

        // App State
        let currentCards = [];
        let originalCards = [];
        let currentIndex = 0;
        let isFlipped = false;
        let viewedCards = new Set();
        let correctCards = new Set();
        let studyMode = 'sequential';

        // DOM Elements
        const topicSelector = document.getElementById('topicSelector');
        const modeButtons = document.getElementById('modeButtons');
        const flashcard = document.getElementById('flashcard');
        const cardFront = document.getElementById('cardFront');
        const cardBack = document.getElementById('cardBack');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const skipBtn = document.getElementById('skipBtn');
        const correctBtn = document.getElementById('correctBtn');
        const progressBar = document.getElementById('progressBar');
        const progress = document.getElementById('progress');
        const totalCardsEl = document.getElementById('totalCards');
        const scoreCardsEl = document.getElementById('scoreCards');
        const incorrectCardsEl = document.getElementById('incorrectCards');
        const shortcutsLegend = document.getElementById('shortcutsLegend');

        // Load from localStorage
        function loadFromStorage() {
            const saved = localStorage.getItem('clasKoreanFlashcards_v2');
            if (saved) {
                const data = JSON.parse(saved);
                correctCards = new Set(data.correctCards || []);
                viewedCards = new Set(data.viewedCards || []);
            }
        }

        // Save to localStorage
        function saveToStorage() {
            const data = {
                correctCards: Array.from(correctCards),
                viewedCards: Array.from(viewedCards)
            };
            localStorage.setItem('clasKoreanFlashcards_v2', JSON.stringify(data));
        }

        // Fisher-Yates shuffle algorithm
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        // Initialize topics
        function initializeTopics() {
            const topics = [...new Set(flashcards.map(card => card.topic))];
            topics.forEach(topic => {
                const option = document.createElement('option');
                option.value = topic;
                option.textContent = topic;
                topicSelector.appendChild(option);
            });
        }

        // Filter cards by topic
        function filterCards(topic) {
            originalCards = flashcards.filter(card => card.topic === topic);
            applyStudyMode();
            currentIndex = 0;
            isFlipped = false;
            flashcard.classList.remove('flipped');
            correctBtn.classList.remove('show');
            modeButtons.style.display = 'flex';
            shortcutsLegend.style.display = 'block';
            updateCard();
            updateProgress();
            updateStats();
        }

        // Apply study mode
        function applyStudyMode() {
            switch(studyMode) {
                case 'shuffle':
                    currentCards = shuffleArray(originalCards);
                    break;
                case 'incorrect':
                    const incorrect = originalCards.filter((card, index) => {
                        const cardKey = `${card.topic}-${index}`;
                        return !correctCards.has(cardKey);
                    });
                    currentCards = incorrect.length > 0 ? incorrect : originalCards;
                    break;
                default:
                    currentCards = [...originalCards];
            }
        }

        // Set study mode
        function setStudyMode(mode) {
            studyMode = mode;
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(mode + 'Btn').classList.add('active');
            applyStudyMode();
            currentIndex = 0;
            isFlipped = false;
            flashcard.classList.remove('flipped');
            correctBtn.classList.remove('show');
            updateCard();
            updateProgress();
            updateStats();
        }

        // Update card display
        function updateCard() {
            if (currentCards.length === 0) {
                cardFront.textContent = 'Select a topic to begin';
                cardBack.textContent = 'Flip to see answer';
                prevBtn.disabled = true;
                nextBtn.disabled = true;
                skipBtn.disabled = true;
                correctBtn.classList.remove('show');
                return;
            }

            const card = currentCards[currentIndex];
            cardFront.textContent = card.front;
            cardBack.textContent = card.back;
            
            prevBtn.disabled = currentIndex === 0;
            nextBtn.disabled = currentIndex === currentCards.length - 1;
            skipBtn.disabled = false;
            
            if (isFlipped) {
                correctBtn.classList.add('show');
            } else {
                correctBtn.classList.remove('show');
            }
            
            const originalIndex = originalCards.findIndex(c => c.front === card.front && c.back === card.back);
            if (originalIndex === -1) return; // Safety check
            
            const originalCard = originalCards[originalIndex];
            const cardKey = `${originalCard.topic}-${originalIndex}`;
            if (correctCards.has(cardKey)) {
                correctBtn.textContent = '‚úÖ Already Correct';
                correctBtn.disabled = true;
                correctBtn.classList.add('show');
            } else {
                correctBtn.textContent = 'Mark Correct ‚úÖ';
                correctBtn.disabled = false;
            }
        }

        // Flip card
        function flipCard() {
            if (currentCards.length === 0) return;
            
            isFlipped = !isFlipped;
            flashcard.classList.toggle('flipped');
            
            if (isFlipped) {
                const originalIndex = originalCards.findIndex(c => 
                    c.front === currentCards[currentIndex].front && c.back === currentCards[currentIndex].back
                );
                if (originalIndex === -1) return; // Safety check
                
                const originalCard = originalCards[originalIndex];
                const cardKey = `${originalCard.topic}-${originalIndex}`;
                viewedCards.add(cardKey);
                saveToStorage();
            }
            
            updateCard();
            updateStats();
        }

        // Mark card as correct
        function markCorrect() {
            if (currentCards.length === 0 || !isFlipped) return;
            
            const originalIndex = originalCards.findIndex(c => 
                c.front === currentCards[currentIndex].front && c.back === currentCards[currentIndex].back
            );
            if (originalIndex === -1) return; // Safety check
            
            const originalCard = originalCards[originalIndex];
            const cardKey = `${originalCard.topic}-${originalIndex}`;
            correctCards.add(cardKey);
            saveToStorage();
            
            correctBtn.textContent = '‚úÖ Already Correct';
            correctBtn.disabled = true;
            
            updateStats();
        }

        // Skip card
        function skipCard() {
            if (currentCards.length === 0) return;
            
            const currentCard = currentCards[currentIndex];
            const newCurrentCards = [...currentCards];
            newCurrentCards.splice(currentIndex, 1);
            newCurrentCards.push(currentCard);
            currentCards = newCurrentCards;
            
            isFlipped = false;
            flashcard.classList.remove('flipped');
            correctBtn.classList.remove('show');
            updateCard();
            updateProgress();
        }

        // Navigation
        function previousCard() {
            if (currentIndex > 0) {
                currentIndex--;
                isFlipped = false;
                flashcard.classList.remove('flipped');
                correctBtn.classList.remove('show');
                updateCard();
                updateProgress();
            }
        }

        function nextCard() {
            if (currentIndex < currentCards.length - 1) {
                currentIndex++;
                isFlipped = false;
                flashcard.classList.remove('flipped');
                correctBtn.classList.remove('show');
                updateCard();
                updateProgress();
            }
        }

        // Update progress
        function updateProgress() {
            if (currentCards.length === 0) {
                progress.textContent = '0 / 0 cards';
                progressBar.style.width = '0%';
                return;
            }
            progress.textContent = `${currentIndex + 1} / ${currentCards.length} cards`;
            progressBar.style.width = `${((currentIndex + 1) / currentCards.length) * 100}%`;
        }

        // Update stats
        function updateStats() {
            if (currentCards.length === 0) {
                totalCardsEl.textContent = '0';
                scoreCardsEl.textContent = '0';
                incorrectCardsEl.textContent = '0';
                return;
            }
            
            totalCardsEl.textContent = originalCards.length;
            const topicCorrect = Array.from(correctCards).filter(key => 
                key.startsWith(originalCards[0]?.topic || '')
            ).length;
            scoreCardsEl.textContent = topicCorrect;
            const topicIncorrect = originalCards.length - topicCorrect;
            incorrectCardsEl.textContent = topicIncorrect;
        }

        // Reset session
        function resetSession() {
            currentCards = [];
            originalCards = [];
            currentIndex = 0;
            isFlipped = false;
            studyMode = 'sequential';
            
            modeButtons.style.display = 'none';
            shortcutsLegend.style.display = 'none';
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('sequentialBtn').classList.add('active');
            
            flashcard.classList.remove('flipped');
            correctBtn.classList.remove('show');
            correctBtn.textContent = 'Mark Correct ‚úÖ';
            correctBtn.disabled = false;
            topicSelector.value = "";
            
            cardFront.textContent = 'Select a topic to begin';
            cardBack.textContent = 'Flip to see answer';
            prevBtn.disabled = true;
            nextBtn.disabled = true;
            skipBtn.disabled = true;
            
            updateProgress();
            updateStats();
        }

        // Touch gestures
        let touchStartX = 0;
        let touchEndX = 0;

        flashcard.addEventListener('touchstart', e => {
            touchStartX = e.changedTouches[0].screenX;
        });

        flashcard.addEventListener('touchend', e => {
            touchEndX = e.changedTouches[0].screenX;
            handleSwipe();
        });

        function handleSwipe() {
            if (currentCards.length === 0) return;
            
            const swipeThreshold = 50;
            const diff = touchStartX - touchEndX;
            
            if (Math.abs(diff) > swipeThreshold) {
                if (diff > 0) {
                    nextCard();
                } else {
                    previousCard();
                }
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (currentCards.length === 0 && e.key !== 'r' && e.key !== 'R') return;
            
            if (e.key === 'ArrowLeft') previousCard();
            if (e.key === 'ArrowRight') nextCard();
            if (e.key === ' ' || e.key === 'Enter') {
                e.preventDefault();
                flipCard();
            }
            if (e.key === 'c' || e.key === 'C') {
                if (isFlipped && !correctBtn.disabled) {
                    markCorrect();
                }
            }
            if (e.key === 's' || e.key === 'S') {
                skipCard();
            }
            if (e.key === 'r' || e.key === 'R') {
                resetSession();
            }
        });

        // Event listeners
        topicSelector.addEventListener('change', (e) => {
            if (e.target.value) {
                filterCards(e.target.value);
            }
        });

        flashcard.addEventListener('click', flipCard);

        // Initialize
        loadFromStorage();
        initializeTopics();
        updateStats();
    </script>
</body>
</html>



